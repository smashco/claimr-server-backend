"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{3003:(e,t,r)=>{r.d(t,{A:()=>c});var o=r(5155),a=r(2115),n=r(164),i=r(7529),l=r(1463);function s({territory:e,onClose:t,onPreview:r,onRentSuccess:n,onDesignClick:s}){let[d,c]=(0,a.useState)(3),[p,g]=(0,a.useState)(null),[u,x]=(0,a.useState)(null),[m,h]=(0,a.useState)(""),[y,b]=(0,a.useState)(()=>{{let e=localStorage.getItem("brandProfile");return e?JSON.parse(e).name:""}}),[f,w]=(0,a.useState)(!1),[j,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let t=localStorage.getItem(`design_${e.id}`),r=localStorage.getItem(`design_${e.id}_overlay`),o=localStorage.getItem(`design_${e.id}_bg`);t&&fetch(t).then(e=>e.blob()).then(t=>{g(new File([t],`design_${e.id}.png`,{type:"image/png"}))}),r&&fetch(r).then(e=>e.blob()).then(t=>{x(new File([t],`design_${e.id}_overlay.png`,{type:"image/png"}))}),o&&h(o)},[e.id]);let S=Math.max(1,Math.ceil(.005*e.areaSqFt*d)),k=async()=>{if(!p||!y)return void alert("Please fill in all fields");w(!0);try{let r=new FormData;r.append("territoryId",e.id.toString()),r.append("brandName",y),r.append("durationDays",d.toString()),r.append("amountPaid",S.toString()),r.append("adContent",p),u&&r.append("overlayContent",u),m&&r.append("backgroundColor",m);let o=await i.F.createAd(r);if(!o.success)throw Error("Failed to create ad");let a=o.adId.toString().substring(0,8),s=await i.F.createOrder(S,`rcpt_${a}_${Date.now().toString().slice(-4)}`),c={key:l.env.NEXT_PUBLIC_RAZORPAY_KEY_ID||"rzp_test_REQBbbQLxB81Vh",amount:s.amount,currency:s.currency,name:"RunerrX",description:`Rent ${e.name} for ${d} days`,order_id:s.id,handler:async function(e){try{await i.F.verifyPayment({razorpay_order_id:e.razorpay_order_id,razorpay_payment_id:e.razorpay_payment_id,razorpay_signature:e.razorpay_signature,adId:o.adId}),v(!0),n&&n(),setTimeout(()=>{t()},2e3)}catch(e){console.error(e),alert("Payment verification failed")}},prefill:{name:y,email:"brand@example.com",contact:"9999999999"},theme:{color:"#3b82f6"}},g=new window.Razorpay(c);g.on("payment.failed",function(e){alert(e.error.description)}),g.open()}catch(e){console.error(e),alert("Failed to initiate rental process")}finally{w(!1)}};if(!window.Razorpay){let e=document.createElement("script");e.src="https://checkout.razorpay.com/v1/checkout.js",e.async=!0,document.body.appendChild(e)}return(0,o.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.8)",zIndex:999999,display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},onClick:t,children:(0,o.jsxs)("div",{style:{backgroundColor:"#1a1a1a",borderRadius:"16px",padding:"24px",maxWidth:"500px",width:"100%",position:"relative",border:"1px solid rgba(255, 255, 255, 0.1)"},onClick:e=>e.stopPropagation(),children:[(0,o.jsx)("button",{onClick:t,style:{position:"absolute",top:"16px",right:"16px",background:"none",border:"none",color:"#999",fontSize:"24px",cursor:"pointer"},children:"\xd7"}),j?(0,o.jsxs)("div",{style:{textAlign:"center",padding:"40px 0",color:"#4ade80"},children:[(0,o.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"✓"}),(0,o.jsx)("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"white",marginBottom:"8px"},children:"Success!"}),(0,o.jsx)("p",{children:"Territory Rented Successfully."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"white",marginBottom:"4px"},children:["Rent ",e.name]}),(0,o.jsxs)("p",{style:{color:"#999",fontSize:"14px",marginBottom:"24px"},children:["Area: ",Math.round(e.areaSqFt).toLocaleString()," sqft"]}),(0,o.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,o.jsx)("label",{style:{display:"block",fontSize:"14px",color:"#999",marginBottom:"4px"},children:"Brand Name"}),(0,o.jsx)("input",{type:"text",value:y,onChange:e=>b(e.target.value),placeholder:"Enter your brand name",style:{width:"100%",padding:"12px",backgroundColor:"rgba(0, 0, 0, 0.5)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"8px",color:"white",fontSize:"14px"}})]}),(0,o.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,o.jsx)("label",{style:{display:"block",fontSize:"14px",color:"#999",marginBottom:"4px"},children:"Duration"}),(0,o.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"},children:[3,7,30].map(e=>(0,o.jsxs)("button",{onClick:()=>c(e),style:{padding:"8px",borderRadius:"8px",border:`1px solid ${d===e?"#3b82f6":"rgba(255, 255, 255, 0.1)"}`,backgroundColor:d===e?"#3b82f6":"rgba(0, 0, 0, 0.5)",color:d===e?"white":"#999",fontSize:"14px",fontWeight:"500",cursor:"pointer"},children:[e," Days"]},e))})]}),(0,o.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,o.jsx)("label",{style:{display:"block",fontSize:"14px",color:"#999",marginBottom:"8px"},children:"Ad Creative"}),p?(0,o.jsxs)("div",{style:{position:"relative",border:"2px solid #22c55e",borderRadius:"12px",padding:"16px",backgroundColor:"rgba(34, 197, 94, 0.1)",textAlign:"center"},children:[(0,o.jsx)("div",{style:{color:"#22c55e",fontWeight:"bold",marginBottom:"8px"},children:"✓ Design Ready"}),(0,o.jsx)("img",{src:URL.createObjectURL(p),alt:"Ad Preview",style:{maxWidth:"100%",maxHeight:"150px",borderRadius:"8px",margin:"0 auto",display:"block"}}),(0,o.jsx)("button",{onClick:()=>g(null),style:{marginTop:"12px",color:"#ef4444",background:"none",border:"none",fontSize:"12px",cursor:"pointer",textDecoration:"underline"},children:"Remove & Design Again"})]}):(0,o.jsxs)("button",{onClick:()=>{s?s():window.open(`/brand/design?territoryId=${e.id}`,"_blank")},style:{width:"100%",padding:"20px",border:"2px dashed #3b82f6",borderRadius:"12px",backgroundColor:"rgba(59, 130, 246, 0.1)",color:"#60a5fa",fontSize:"16px",fontWeight:"bold",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:"8px"},children:[(0,o.jsx)("span",{style:{fontSize:"24px"},children:"\uD83C\uDFA8"}),"Design Your Area",(0,o.jsx)("span",{style:{fontSize:"12px",fontWeight:"normal",color:"#9ca3af"},children:"Open the Design Studio to create your ad"})]})]}),(0,o.jsxs)("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",paddingTop:"16px",marginTop:"24px"},children:[(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[(0,o.jsx)("span",{style:{color:"#999"},children:"Total Price"}),(0,o.jsxs)("span",{style:{fontSize:"24px",fontWeight:"bold",color:"white"},children:["₹",S.toLocaleString()]})]}),(0,o.jsx)("button",{onClick:k,disabled:f||!p||!y,style:{flex:1,background:"linear-gradient(to right, #3b82f6, #8b5cf6)",color:"white",fontWeight:"bold",padding:"16px",borderRadius:"12px",border:"none",cursor:!f&&p&&y?"pointer":"not-allowed",opacity:!f&&p&&y?1:.5,fontSize:"16px"},children:f?"Processing...":"Pay & Rent Now"})]}),p&&(0,o.jsx)("button",{onClick:()=>{if(p&&e.geometry&&e.geometry.coordinates)try{let t=e.geometry.coordinates[0],o=90,a=-90,n=180,i=-180;t.forEach(e=>{let t=e[0],r=e[1];r<o&&(o=r),r>a&&(a=r),t<n&&(n=t),t>i&&(i=t)});let l=[[n,a],[i,a],[i,o],[n,o]],s=URL.createObjectURL(p);r(s,l)}catch(e){console.error("Error preparing preview",e)}},style:{width:"100%",marginTop:"12px",backgroundColor:"rgba(255, 255, 255, 0.1)",color:"white",fontWeight:"bold",padding:"12px",borderRadius:"12px",border:"1px solid rgba(255, 255, 255, 0.2)",cursor:"pointer",fontSize:"14px"},children:"\uD83D\uDC41 Preview on Map"})]})]})})}r(3879);var d=r(7936);function c({onDesignClick:e,focusTerritory:t,openModalOnFocus:r=!1}){let[l,c]=(0,a.useState)([]),[g,u]=(0,a.useState)(null),[x,m]=(0,a.useState)(!1),[h,y]=(0,a.useState)({latitude:40.7128,longitude:-74.006,zoom:12,pitch:45,bearing:0}),[b,f]=(0,a.useState)(null),[w,j]=(0,a.useState)(null),[v,S]=(0,a.useState)(0),[k,C]=(0,a.useState)(1),[N,z]=(0,a.useState)(1),[F,_]=(0,a.useState)(1);(0,a.useEffect)(()=>{t&&(console.log("Focusing on territory:",t),y(e=>({...e,latitude:t.center.lat,longitude:t.center.lng,zoom:16,pitch:60,bearing:0})),u(t),r&&m(!0))},[t]);let R=async()=>{try{let e=await i.F.getTerritories();c(e)}catch(e){console.error("Failed to fetch territories:",e)}},A=(0,a.useMemo)(()=>{if(!w)return null;let e=(w[0][0]+w[2][0])/2,t=(w[0][1]+w[2][1])/2;return w.map(r=>{let o=r[0],a=r[1],n=o-e,i=a-t;n*=N,i*=F;let l=v*Math.PI/180;return[e+((n*=k)*Math.cos(l)-(i*=k)*Math.sin(l)),t+(n*Math.sin(l)+i*Math.cos(l))]})},[w,v,k,N,F]);(0,a.useCallback)(e=>{u(e)},[]),(0,a.useEffect)(()=>{navigator.geolocation&&!t&&navigator.geolocation.getCurrentPosition(e=>{y(t=>({...t,latitude:e.coords.latitude,longitude:e.coords.longitude}))},e=>console.warn("Geolocation error:",e))},[t]),(0,a.useEffect)(()=>{(async()=>{try{let e=await i.F.getTerritories();if(console.log("[Map] Loaded territories from API:",e),console.log("[Map] First territory:",e[0]),console.log("[Map] First territory has geometry?",!!e[0]?.geometry),c(e),e.length>0&&!t){let t=1/0,r=-1/0,o=1/0,a=-1/0;e.forEach(e=>{e.center.lat<t&&(t=e.center.lat),e.center.lat>r&&(r=e.center.lat),e.center.lng<o&&(o=e.center.lng),e.center.lng>a&&(a=e.center.lng)});let n=(t+r)/2,i=(o+a)/2;y(e=>({...e,latitude:n,longitude:i,zoom:14}))}}catch(e){console.error("Failed to load territories",e)}})()},[t]);let P=(0,a.useMemo)(()=>({type:"FeatureCollection",features:l.map(e=>({type:"Feature",geometry:e.geometry,properties:{id:e.id,name:e.name||"",price:e.rentPrice||0,color:e.activeAd?"#FF0000":"#00FF00",isRented:!!e.activeAd,ownerName:e.ownerName||"",ownerImage:e.ownerImage||""}}))}),[l]);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.Ay,{...h,onMove:e=>y(e.viewState),style:{width:"100%",height:"100%",filter:"invert(1) hue-rotate(180deg) brightness(0.7) contrast(1.2)"},mapStyle:{version:8,sources:{"osm-tiles":{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"\xa9 OpenStreetMap contributors"}},layers:[{id:"osm-layer",type:"raster",source:"osm-tiles",minzoom:0,maxzoom:22}],glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf"},interactiveLayerIds:["territory-fill"],cursor:"pointer",onClick:e=>{console.log("Map clicked!",e);let t=e.features;if(!t||0===t.length)try{let r=e.target.queryRenderedFeatures(e.point,{layers:["territory-fill"]});console.log("Manual query features:",r),t=r}catch(e){console.warn("Manual query failed:",e)}if(b)return;let r=t?.[0];if(r){console.log("Feature properties:",r.properties);let e=r.properties?.id,t=l.find(t=>t.id===e);console.log("Found territory:",t),t&&(u(t),m(!0))}else console.log("No features found at click location")},children:[(0,o.jsxs)(n.kL,{id:"territories",type:"geojson",data:P,children:[(0,o.jsx)(n.Wd,{id:"territory-fill",type:"fill",paint:{"fill-color":["get","color"],"fill-opacity":.4,"fill-outline-color":"#FFFFFF"}}),(0,o.jsx)(n.Wd,{id:"territory-outline",type:"line",paint:{"line-color":["get","color"],"line-width":4,"line-blur":2}})]}),b&&A&&(0,o.jsx)(n.kL,{id:"ad-preview",type:"image",url:b.url,coordinates:A,children:(0,o.jsx)(n.Wd,{id:"ad-preview-layer",type:"raster",paint:{"raster-opacity":.9,"raster-fade-duration":0}})}),g&&!b&&(0,o.jsx)(n.zD,{latitude:g.center.lat,longitude:g.center.lng,closeButton:!1,closeOnClick:!1,anchor:"bottom",offset:20,className:"z-50",children:(0,o.jsxs)("div",{className:"glass-panel p-4 rounded-xl border border-white/10 min-w-[200px]",children:[(0,o.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,o.jsx)("h3",{className:"font-bold text-white",children:g.name}),(0,o.jsx)("button",{onClick:()=>u(null),className:"text-slate-400 hover:text-white",children:"\xd7"})]}),g.activeAd?(0,o.jsxs)("div",{className:"mb-3 p-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:[(0,o.jsx)("p",{className:"text-xs text-red-400 font-bold uppercase mb-1",children:"Rented By You"}),(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[(0,o.jsx)("div",{className:"w-6 h-6 rounded-full bg-slate-700 overflow-hidden border border-white/20",children:(0,o.jsx)("img",{src:`https://api.dicebear.com/7.x/avataaars/svg?seed=${g.ownerName}`,alt:"Owner"})}),(0,o.jsx)("span",{className:"text-xs text-slate-400",children:"X"}),(0,o.jsx)("div",{className:"w-6 h-6 rounded-full bg-white overflow-hidden border border-white/20 p-0.5",children:(0,o.jsx)("img",{src:localStorage.getItem("brandProfile")?JSON.parse(localStorage.getItem("brandProfile")).logo:"/nike-logo.png",alt:"Brand",className:"w-full h-full object-contain"})})]})]}):(0,o.jsxs)("div",{className:"mb-3",children:[(0,o.jsx)("p",{className:"text-xs text-green-400 font-bold uppercase",children:"Available"}),(0,o.jsxs)("p",{className:"text-lg font-bold text-white",children:["₹",(g.rentPrice||0).toLocaleString(),(0,o.jsx)("span",{className:"text-xs text-slate-400 font-normal",children:"/hr"})]})]}),(0,o.jsx)("button",{onClick:()=>{g.activeAd||m(!0)},className:"w-full bg-gradient-to-r from-cyan-600 to-purple-600 hover:from-cyan-500 hover:to-purple-500 text-white font-bold py-2 rounded-lg shadow-lg shadow-cyan-500/20 text-sm transition-all",children:g.activeAd?"Manage Ad":"Rent Territory"})]})})]}),b&&(0,o.jsxs)(d.P.div,{initial:{y:100,opacity:0},animate:{y:0,opacity:1},className:"absolute bottom-8 left-1/2 -translate-x-1/2 z-50 glass-panel p-6 rounded-2xl border border-white/10 flex flex-col gap-4 min-w-[320px]",children:[(0,o.jsx)("h3",{className:"text-white font-bold text-sm uppercase tracking-wider mb-2",children:"Adjust Ad Placement"}),(0,o.jsx)(p,{label:"Rotate",value:v,min:-180,max:180,onChange:S,unit:"\xb0"}),(0,o.jsx)(p,{label:"Scale",value:k,min:.5,max:2,step:.05,onChange:C,unit:"x"}),(0,o.jsx)(p,{label:"Stretch X",value:N,min:.5,max:2,step:.05,onChange:z,unit:"x"}),(0,o.jsx)(p,{label:"Stretch Y",value:F,min:.5,max:2,step:.05,onChange:_,unit:"x"}),(0,o.jsxs)("div",{className:"flex gap-3 mt-2",children:[(0,o.jsx)("button",{onClick:()=>{S(0),C(1),z(1),_(1)},className:"flex-1 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-slate-300 text-xs font-medium transition-colors",children:"Reset"}),(0,o.jsx)("button",{onClick:()=>{f(null),j(null),S(0),C(1),z(1),_(1)},className:"flex-1 py-2 rounded-lg bg-cyan-500 hover:bg-cyan-400 text-black text-xs font-bold transition-colors shadow-lg shadow-cyan-500/20",children:"Apply Changes"})]})]}),x&&g&&(0,o.jsx)(s,{territory:g,onClose:()=>m(!1),onPreview:(e,t)=>{f({url:e,coordinates:t}),m(!1)},onRentSuccess:()=>{R()},onDesignClick:e?()=>{g&&(console.log("[Map] Passing territory to onDesignClick:",g),console.log("[Map] Territory has geometry?",!!g.geometry),e(g),m(!1))}:void 0})]})}function p({label:e,value:t,min:r,max:a,step:n=1,onChange:i,unit:l}){return(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("label",{className:"text-slate-400 text-xs w-16",children:e}),(0,o.jsx)("input",{type:"range",min:r,max:a,step:n,value:t,onChange:e=>i(Number(e.target.value)),className:"flex-1 h-1 bg-white/10 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),(0,o.jsxs)("span",{className:"text-white text-xs w-8 text-right font-mono",children:[t,l]})]})}},7529:(e,t,r)=>{r.d(t,{F:()=>n});var o=r(9185);let a="https://claimr-server.onrender.com",n={getTerritories:async()=>(await o.A.get(`${a}/api/brands/territories`)).data,calculatePrice:async(e,t)=>(await o.A.post(`${a}/api/brands/calculate-price`,{areaSqFt:e,laps:t})).data,createAd:async e=>(await o.A.post(`${a}/api/brands/create-ad`,e,{headers:{"Content-Type":"multipart/form-data"}})).data,createOrder:async(e,t)=>(await o.A.post(`${a}/api/brands/create-order`,{amount:e,receipt:t})).data,verifyPayment:async e=>(await o.A.post(`${a}/api/brands/verify-payment`,e)).data}}}]);