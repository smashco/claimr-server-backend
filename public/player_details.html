<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Player Details</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
   <style>
       body { background-color: #212529; color: #dee2e6; }
       .card { background-color: #343a40; }
       .list-group-item { background-color: #3a4148; border-color: #495057; }
       .value { color: #D4FF00; font-weight: bold; }
   </style>
</head>
<body>
   <div class="container py-4">
       <div class="d-flex justify-content-between align-items-center mb-4">
           <h1 id="username-title">Player Details</h1>
           <a href="/admin/dashboard" class="btn btn-secondary">Back to Dashboard</a>
       </div>


       <div class="card">
           <div class="card-body">
               <div class="row">
                   <div class="col-md-3 text-center">
                       <img id="profile-image" src="" class="img-fluid rounded-circle mb-3" style="max-width: 150px; border: 3px solid #D4FF00;" alt="Profile Image">
                   </div>
                   <div class="col-md-9">
                       <h3 id="display-name" class="mb-3"></h3>
                       <div class="row">
                           <!-- Column 1 -->
                           <div class="col-md-6">
                               <ul class="list-group">
                                   <li class="list-group-item d-flex justify-content-between"><strong>Google ID:</strong> <span id="owner-id" class="value"></span></li>
                                   <li class="list-group-item d-flex justify-content-between"><strong>Unique 6-Digit ID:</strong> <span id="unique-id" class="value"></span></li>
                                   <li class="list-group-item d-flex justify-content-between"><strong>Phone Number:</strong> <span id="phone" class="value"></span></li>
                                   <li class="list-group-item d-flex justify-content-between"><strong>Instagram:</strong> <span id="instagram" class="value"></span></li>
                                   <li class="list-group-item d-flex justify-content-between"><strong>Joined:</strong> <span id="created-at" class="value"></span></li>
                               </ul>
                           </div>
                           <!-- Column 2 -->
                           <div class="col-md-6">
                               <ul class="list-group">
                                   <li class="list-group-item d-flex justify-content-between"><strong>Is Paid Subscriber:</strong> <span id="is-paid" class="value"></span></li>
                                   <li class="list-group-item d-flex justify-content-between"><strong>Gender:</strong> <span id="gender" class="value"></span></li>
                                   <li class="list-group-item d-flex justify-content-between"><strong>Age:</strong> <span id="age" class="value"></span></li>
                                   <li class="list-group-item d-flex justify-content-between"><strong>Height:</strong> <span id="height" class="value"></span></li>
                                   <li class="list-group-item d-flex justify-content-between"><strong>Weight:</strong> <span id="weight" class="value"></span></li>
                               </ul>
                           </div>
                       </div>
                   </div>
               </div>
           </div>
       </div>


       <div class="card mt-4">
           <div class="card-header">
               <h5>Game Stats</h5>
           </div>
           <div class="card-body">
               <ul class="list-group">
                   <li class="list-group-item d-flex justify-content-between"><strong>Total Area Claimed:</strong> <span id="area-sqm" class="value"></span></li>
                   <li class="list-group-item d-flex justify-content-between"><strong>Signature Color:</strong> <span id="identity-color" class="value d-flex align-items-center"></span></li>
                   <li class="list-group-item d-flex justify-content-between"><strong>Shield Active:</strong> <span id="shield-active" class="value"></span></li>
                   <li class="list-group-item d-flex justify-content-between"><strong>Carve Mode Active:</strong> <span id="carve-mode" class="value"></span></li>
               </ul>
           </div>
       </div>
   </div>


   <script>
       async function apiFetch(url, options = {}) {
           options.credentials = 'include';
           const response = await fetch(url, options);
           if (response.status === 401 || response.status === 403) {
               alert('Session expired. Please log in again.');
               window.location.href = '/admin/login';
               throw new Error('Unauthorized');
           }
           if (!response.ok) {
               const errorData = await response.json().catch(() => ({ message: `HTTP error! status: ${response.status}` }));
               throw new Error(errorData.message || 'An unknown error occurred.');
           }
           return response.json();
       }


       function populateField(id, value, defaultValue = 'N/A') {
           const element = document.getElementById(id);
           if (element) {
               element.textContent = value ?? defaultValue;
           }
       }


       window.onload = async () => {
           const params = new URLSearchParams(window.location.search);
           const playerId = params.get('id');
           if (!playerId) {
               document.getElementById('username-title').textContent = 'Error: No Player ID provided.';
               return;
           }


           try {
               const player = await apiFetch(`/admin/api/player/${playerId}`);


               // Populate all fields
               document.getElementById('profile-image').src = player.profile_image_url || 'https://via.placeholder.com/150';
               document.getElementById('username-title').textContent = `Details for ${player.username}`;
               populateField('display-name', player.owner_name);
               populateField('owner-id', player.owner_id);
               populateField('unique-id', player.unique_player_id);
               populateField('phone', player.phone_number);
               populateField('instagram', player.instagram_id);
               populateField('created-at', new Date(player.created_at).toLocaleString());
              
               populateField('is-paid', player.is_paid ? 'Yes' : 'No');
               populateField('gender', player.gender);
               populateField('age', player.age);
               populateField('height', player.height_cm ? `${player.height_cm} cm` : 'N/A');
               populateField('weight', player.weight_kg ? `${player.weight_kg} kg` : 'N/A');
              
               populateField('area-sqm', player.area_sqm ? `${(player.area_sqm / 1000000).toFixed(6)} km²` : '0 km²');
               const colorSpan = document.getElementById('identity-color');
               colorSpan.innerHTML = `${player.identity_color} <span class="d-inline-block ms-2" style="width: 20px; height: 20px; background-color: ${player.identity_color}; border-radius: 50%;"></span>`;


               populateField('shield-active', player.is_shield_active ? 'Yes' : 'No');
               populateField('carve-mode', player.is_carve_mode_active ? 'Yes' : 'No');


           } catch (error) {
               console.error('Error fetching player details:', error);
               document.getElementById('username-title').textContent = `Error: ${error.message}`;
           }
       };
   </script>
</body>
</html>